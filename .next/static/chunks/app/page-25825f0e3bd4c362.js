(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6913:function(e,s,t){Promise.resolve().then(t.bind(t,4574))},4574:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return ea}});var a=t(7437),l=t(5806),i=t(2265),r=t(3023),c=t(1908),n=t(6672),d=t(6110),x=t(7579),o=t(9251),m=t(1295),u=t(5589),h=t(8291),p=t(7972),f=t(1424);function j(){let{signIn:e,signUp:s}=(0,l.a)(),[t,j]=(0,i.useState)(!1),[g,N]=(0,i.useState)(""),[v,b]=(0,i.useState)(""),[y,w]=(0,i.useState)(""),[_,k]=(0,i.useState)(""),[Z,F]=(0,i.useState)(""),[S,A]=(0,i.useState)("user"),C=async s=>{s.preventDefault(),j(!0);let{error:t}=await e(g,v);t?f.Am.error(t.message||"Failed to sign in"):f.Am.success("Welcome back!"),j(!1)},D=async e=>{e.preventDefault(),j(!0);let{error:t}=await s(y,_,Z,S);t?f.Am.error(t.message||"Failed to sign up"):f.Am.success("Account created successfully!"),j(!1)};return(0,a.jsxs)("div",{className:"w-full max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-[#fdb927] to-[#f59e0b] rounded-[22.5%] shadow-lg shadow-[#fdb927]/30 mb-4",children:(0,a.jsx)(o.Z,{className:"w-11 h-11 text-white"})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 tracking-tight",children:"Ride App"}),(0,a.jsx)("p",{className:"text-[15px] text-gray-600 mt-1",children:"Your journey starts here"})]}),(0,a.jsx)(d.Zb,{className:"ios-card border-gray-200 bg-white overflow-hidden",children:(0,a.jsx)(d.aY,{className:"p-0",children:(0,a.jsxs)(x.mQ,{defaultValue:"login",className:"w-full",children:[(0,a.jsx)("div",{className:"p-4 bg-white border-b border-gray-200",children:(0,a.jsx)("div",{className:"ios-segment",children:(0,a.jsxs)(x.dr,{className:"w-full grid grid-cols-2 bg-transparent p-0 h-auto",children:[(0,a.jsx)(x.SP,{value:"login",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Sign In"}),(0,a.jsx)(x.SP,{value:"signup",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Sign Up"})]})})}),(0,a.jsx)(x.nU,{value:"login",className:"p-6 space-y-5 mt-0 bg-white",children:(0,a.jsxs)("form",{onSubmit:C,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{htmlFor:"login-email",className:"text-[15px] text-gray-700 font-normal",children:"Email"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(c.I,{id:"login-email",type:"email",placeholder:"you@example.com",value:g,onChange:e=>N(e.target.value),required:!0,className:"ios-input pl-11 text-[17px]",autoComplete:"email",disabled:t})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{htmlFor:"login-password",className:"text-[15px] text-gray-700 font-normal",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(c.I,{id:"login-password",type:"password",placeholder:"••••••••",value:v,onChange:e=>b(e.target.value),required:!0,className:"ios-input pl-11 text-[17px]",autoComplete:"current-password",disabled:t})]})]}),(0,a.jsx)(r.z,{type:"submit",disabled:t,className:"w-full ios-button-primary text-[17px] font-semibold mt-6",children:t?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Signing in..."]}):(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Sign In",(0,a.jsx)(h.Z,{className:"w-5 h-5"})]})})]})}),(0,a.jsx)(x.nU,{value:"signup",className:"p-6 space-y-5 mt-0 bg-white",children:(0,a.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{htmlFor:"signup-name",className:"text-[15px] text-gray-700 font-normal",children:"Full Name"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(c.I,{id:"signup-name",type:"text",placeholder:"John Doe",value:Z,onChange:e=>F(e.target.value),required:!0,className:"ios-input pl-11 text-[17px]",autoComplete:"name",disabled:t})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{htmlFor:"signup-email",className:"text-[15px] text-gray-700 font-normal",children:"Email"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(c.I,{id:"signup-email",type:"email",placeholder:"you@example.com",value:y,onChange:e=>w(e.target.value),required:!0,className:"ios-input pl-11 text-[17px]",autoComplete:"email",disabled:t})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{htmlFor:"signup-password",className:"text-[15px] text-gray-700 font-normal",children:"Password"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,a.jsx)(c.I,{id:"signup-password",type:"password",placeholder:"••••••••",value:_,onChange:e=>k(e.target.value),required:!0,minLength:6,className:"ios-input pl-11 text-[17px]",autoComplete:"new-password",disabled:t})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n._,{className:"text-[15px] text-gray-700 font-normal",children:"Account Type"}),(0,a.jsxs)("div",{className:"ios-list rounded-lg overflow-hidden",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>A("user"),disabled:t,className:"ios-list-item w-full flex items-center justify-between ".concat("user"===S?"bg-gray-50":""),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center ".concat("user"===S?"bg-[#007AFF]":"bg-gray-200"),children:(0,a.jsx)(p.Z,{className:"w-5 h-5 ".concat("user"===S?"text-white":"text-gray-600")})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:"Rider"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"Book rides and travel"})]})]}),"user"===S&&(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>A("driver"),disabled:t,className:"ios-list-item w-full flex items-center justify-between ".concat("driver"===S?"bg-gray-50":""),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center ".concat("driver"===S?"bg-[#007AFF]":"bg-gray-200"),children:(0,a.jsx)(o.Z,{className:"w-5 h-5 ".concat("driver"===S?"text-white":"text-gray-600")})}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:"Driver"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"Drive and earn money"})]})]}),"driver"===S&&(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-[#007AFF] flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-white"})})]})]})]}),(0,a.jsx)(r.z,{type:"submit",disabled:t,className:"w-full ios-button-primary text-[17px] font-semibold mt-6",children:t?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Creating account..."]}):(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:["Create Account",(0,a.jsx)(h.Z,{className:"w-5 h-5"})]})})]})})]})})}),(0,a.jsx)("div",{className:"text-center mt-6",children:(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"Secure and encrypted connection"})})]})}var g=t(6763),N=t(4461),v=t(592),b=t(6141),y=t(2682),w=t(1298),_=t(6142);function k(){let{user:e}=(0,l.a)(),[s,t]=(0,i.useState)(null),[c,n]=(0,i.useState)(null),[x,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[p,j]=(0,i.useState)(null),[k,Z]=(0,i.useState)(null),[F,S]=(0,i.useState)(null);(0,i.useEffect)(()=>{s&&c?A():(j(null),Z(null),S(null))},[s,c]);let A=async()=>{if(s&&c){h(!0);try{let e=(c.lat-s.lat)*Math.PI/180,t=(c.lng-s.lng)*Math.PI/180,a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(c.lat*Math.PI/180)*Math.sin(t/2)*Math.sin(t/2),l=6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))),i=5+2.5*l,r=Math.round(l/40*60);S(l),j(i),Z(r)}catch(e){console.error("Error calculating estimate:",e),f.Am.error("Failed to calculate estimate")}finally{h(!1)}}},C=async()=>{if(!s||!c){f.Am.error("Please select both pickup and dropoff locations");return}if(!e){f.Am.error("Please sign in to book a ride");return}m(!0);try{let{data:a,error:l}=await g.O.from("rides").insert([{user_id:e.id,pickup_latitude:s.lat,pickup_longitude:s.lng,pickup_address:s.address||"".concat(s.lat,", ").concat(s.lng),dropoff_latitude:c.lat,dropoff_longitude:c.lng,dropoff_address:c.address||"".concat(c.lat,", ").concat(c.lng),fare_amount:p,status:"requested"}]).select().single();if(l)throw l;f.Am.success("Ride requested!",{description:"Finding a driver nearby..."}),t(null),n(null),j(null),Z(null),S(null)}catch(e){console.error(e),f.Am.error("Failed to book ride",{description:"Please try again"})}finally{m(!1)}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(d.Zb,{className:"ios-card overflow-hidden",children:[(0,a.jsx)(d.Ol,{className:"pb-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.ll,{className:"text-xl font-semibold text-gray-900",children:"Book a Ride"}),(0,a.jsx)(d.SZ,{className:"text-[15px] text-gray-600 mt-0.5",children:"Where would you like to go?"})]}),p&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-[#007AFF]",children:["$",p.toFixed(2)]}),k&&(0,a.jsxs)("div",{className:"text-[13px] text-gray-500 flex items-center gap-1 justify-end",children:[(0,a.jsx)(b.Z,{className:"w-3.5 h-3.5"}),k," min"]})]})]})}),(0,a.jsxs)(d.aY,{className:"space-y-6 p-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(N._,{onLocationSelect:t,label:"Pickup Location",placeholder:"Where should we pick you up?",initialLocation:s||void 0})}),(0,a.jsx)("div",{children:(0,a.jsx)(N._,{onLocationSelect:n,label:"Destination",placeholder:"Where are you going?",initialLocation:c||void 0})}),s&&c&&(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4"}),"Your Route"]}),(0,a.jsx)(v.P,{pickup:s,destination:c,showDetails:!1})]}),p&&!u&&(0,a.jsx)("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mb-1",children:"Estimated Fare"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-[#007AFF]",children:["$",p.toFixed(2)]})]}),k&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mb-1",children:"Duration"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900 flex items-center gap-1",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),k," min"]})]})]}),F&&(0,a.jsx)("div",{className:"pt-2 border-t border-blue-300",children:(0,a.jsxs)("p",{className:"text-[13px] text-gray-600",children:["Distance: ",F.toFixed(2)," km"]})})]})}),(0,a.jsx)(r.z,{onClick:C,disabled:x||u||!s||!c,className:"w-full ios-button-primary text-[17px] h-12",children:x?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Booking..."]}):(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5"}),p?"Book Ride - $".concat(p.toFixed(2)):"Select Locations to Book"]})})]})]}),(0,a.jsxs)("div",{className:"ios-list",children:[(0,a.jsxs)("div",{className:"ios-list-item flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(b.Z,{className:"w-5 h-5 text-green-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:"Fast Pickup"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"Average wait: 3-5 minutes"})]})]}),(0,a.jsxs)("div",{className:"ios-list-item flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(w.Z,{className:"w-5 h-5 text-blue-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:"Transparent Pricing"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"No hidden fees or surge pricing"})]})]}),(0,a.jsxs)("div",{className:"ios-list-item flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(_.Z,{className:"w-5 h-5 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:"Accurate Locations"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:"Powered by Mapbox with real-time search"})]})]})]})]})}var Z=t(9155),F=t(5340),S=t(2549);function A(){let{user:e}=(0,l.a)(),[s,t]=(0,i.useState)([]),[c,n]=(0,i.useState)(!0);(0,i.useEffect)(()=>{x();let s=g.O.channel("active_rides").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:"user_id=eq.".concat(null==e?void 0:e.id)},()=>{x()}).subscribe();return()=>{s.unsubscribe()}},[null==e?void 0:e.id]);let x=async()=>{if(!e)return;let{data:s,error:a}=await g.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["requested","accepted","in_progress"]).order("created_at",{ascending:!1});s&&t(s),n(!1)},o=async e=>{let{error:s}=await g.O.from("rides").update({status:"cancelled"}).eq("id",e);s?f.Am.error("Failed to cancel ride"):f.Am.success("Ride cancelled")},m=e=>{switch(e){case"requested":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"accepted":return"bg-blue-100 text-blue-700 border-blue-200";case"in_progress":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},u=e=>{switch(e){case"requested":return"Finding Driver";case"accepted":return"Driver En Route";case"in_progress":return"In Progress";default:return e}};return c?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{className:"text-gray-900",children:"Active Rides"}),(0,a.jsx)(d.SZ,{className:"text-gray-600",children:"No active rides at the moment"})]})}):(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>{var s;return(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsx)(d.Ol,{className:"border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d.ll,{className:"text-lg font-semibold text-gray-900",children:["Ride #",e.id.slice(0,8)]}),(0,a.jsxs)(d.SZ,{className:"flex items-center gap-2 mt-1 text-gray-600",children:[(0,a.jsx)(b.Z,{className:"w-3.5 h-3.5"}),new Date(e.requested_at).toLocaleTimeString()]})]}),(0,a.jsx)(Z.C,{className:"".concat(m(e.status)," text-[13px] px-2 py-1 rounded-md font-medium border"),children:u(e.status)})]})}),(0,a.jsxs)(d.aY,{className:"space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-green-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[15px] font-medium text-gray-900",children:"Pickup"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.pickup_address||"".concat(e.pickup_latitude.toFixed(4),", ").concat(e.pickup_longitude.toFixed(4))})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(_.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[15px] font-medium text-gray-900",children:"Destination"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.dropoff_address||"".concat(e.dropoff_latitude.toFixed(4),", ").concat(e.dropoff_longitude.toFixed(4))})]})]})]}),e.driver&&(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-50 flex items-center gap-3 border border-gray-200",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.driver.avatar_url?(0,a.jsx)("img",{src:e.driver.avatar_url,alt:e.driver.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)(p.Z,{className:"w-6 h-6 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-[17px]",children:e.driver.full_name}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-0.5",children:[(0,a.jsx)(F.Z,{className:"w-3.5 h-3.5 fill-yellow-500 text-yellow-500"}),(0,a.jsx)("span",{className:"text-[13px] text-gray-600",children:e.driver.rating.toFixed(1)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(w.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",null===(s=e.fare_amount)||void 0===s?void 0:s.toFixed(2)]})]}),"requested"===e.status&&(0,a.jsxs)(r.z,{variant:"destructive",size:"sm",onClick:()=>o(e.id),className:"bg-red-600 hover:bg-red-700 text-white rounded-lg text-[15px] h-9 px-4",children:[(0,a.jsx)(S.Z,{className:"w-4 h-4 mr-1"}),"Cancel"]})]})]})]},e.id)})})}var C=t(8203);function D(){let{user:e}=(0,l.a)(),[s,t]=(0,i.useState)([]),[r,c]=(0,i.useState)(!0);(0,i.useEffect)(()=>{n()},[null==e?void 0:e.id]);let n=async()=>{if(!e)return;let{data:s,error:a}=await g.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["completed","cancelled"]).order("created_at",{ascending:!1}).limit(10);s&&t(s),c(!1)};return r?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{className:"text-gray-900",children:"Ride History"}),(0,a.jsx)(d.SZ,{className:"text-gray-600 text-[15px]",children:"No completed rides yet"})]})}):(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"border-b border-gray-200",children:[(0,a.jsx)(d.ll,{className:"text-gray-900 text-xl font-semibold",children:"Ride History"}),(0,a.jsx)(d.SZ,{className:"text-gray-600 text-[15px]",children:"Your recent trips"})]}),(0,a.jsx)(d.aY,{className:"p-0",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:s.map(e=>{var s;return(0,a.jsxs)("div",{className:"p-4 bg-white hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center",children:(0,a.jsx)(C.Z,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-[17px]",children:new Date(e.completed_at||e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:new Date(e.completed_at||e.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]})]}),(0,a.jsx)(Z.C,{className:"text-[13px] px-2 py-1 rounded-md font-medium border ".concat("completed"===e.status?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"),children:e.status})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(_.Z,{className:"w-3.5 h-3.5 text-green-600"})}),(0,a.jsx)("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.pickup_address||"Pickup location"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(_.Z,{className:"w-3.5 h-3.5 text-blue-600"})}),(0,a.jsx)("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.dropoff_address||"Drop-off location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(w.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",null===(s=e.fare_amount)||void 0===s?void 0:s.toFixed(2)]})]}),e.driver&&"completed"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-50",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),(0,a.jsx)("span",{className:"text-[15px] font-medium text-gray-900",children:e.driver_rating||"Not rated"})]})]})]},e.id)})})})]})}var R=t(7158),O=t(5883);function q(){let{profile:e,signOut:s}=(0,l.a)();return(0,a.jsxs)("div",{className:"min-h-screen bg-[#F2F2F7] pb-20",children:[(0,a.jsx)("div",{className:"ios-navbar",children:(0,a.jsx)("div",{className:"container mx-auto px-4 max-w-6xl",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-14",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Ride App"})})})}),(0,a.jsxs)("div",{className:"container mx-auto p-4 max-w-6xl space-y-4",children:[(0,a.jsxs)("div",{className:"ios-list rounded-xl overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-white px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:(null==e?void 0:e.avatar_url)?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)(p.Z,{className:"w-8 h-8 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:(null==e?void 0:e.full_name)||"User"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-0.5",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),(null==e?void 0:e.rating)?e.rating.toFixed(1):"0.0"]}),(0,a.jsx)("span",{className:"text-gray-300",children:"•"}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4"}),(null==e?void 0:e.total_rides)||0," rides"]})]})]}),(0,a.jsx)(R.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),(0,a.jsx)("div",{className:"ios-separator mx-4"}),(0,a.jsxs)("button",{onClick:s,className:"ios-list-item w-full flex items-center justify-between text-left",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full bg-red-100 flex items-center justify-center",children:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-red-600"})}),(0,a.jsx)("span",{className:"text-[17px] text-red-600 font-normal",children:"Sign Out"})]}),(0,a.jsx)(R.Z,{className:"w-5 h-5 text-gray-400"})]})]}),(0,a.jsxs)(x.mQ,{defaultValue:"book",className:"space-y-4",children:[(0,a.jsx)("div",{className:"ios-segment",children:(0,a.jsxs)(x.dr,{className:"w-full grid grid-cols-3 bg-transparent p-0 h-auto",children:[(0,a.jsx)(x.SP,{value:"book",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Book Ride"}),(0,a.jsx)(x.SP,{value:"active",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Active"}),(0,a.jsx)(x.SP,{value:"history",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"History"})]})}),(0,a.jsx)(x.nU,{value:"book",className:"mt-4 space-y-4",children:(0,a.jsx)(k,{})}),(0,a.jsx)(x.nU,{value:"active",className:"mt-4",children:(0,a.jsx)(A,{})}),(0,a.jsx)(x.nU,{value:"history",className:"mt-4",children:(0,a.jsx)(D,{})})]})]})]})}var P=t(7498),Y=t(9311);let E=i.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(P.fC,{className:(0,Y.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...l,ref:s,children:(0,a.jsx)(P.bU,{className:(0,Y.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});E.displayName=P.fC.displayName;var M=t(2442);function z(){let{user:e}=(0,l.a)(),[s,t]=(0,i.useState)([]),[c,n]=(0,i.useState)(!0);(0,i.useEffect)(()=>{x();let e=g.O.channel("available_rides").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:"status=eq.requested"},()=>{x()}).subscribe();return()=>{e.unsubscribe()}},[]);let x=async()=>{let{data:e,error:s}=await g.O.from("rides").select("*, user:profiles!rides_user_id_fkey(*)").eq("status","requested").is("driver_id",null).order("created_at",{ascending:!1});e&&t(e),n(!1)},o=async s=>{let{error:t}=await g.O.from("rides").update({driver_id:null==e?void 0:e.id,status:"accepted",accepted_at:new Date().toISOString()}).eq("id",s);t?f.Am.error("Failed to accept ride"):f.Am.success("Ride accepted! Heading to pickup location...")},m=(e,s,t,a)=>(111*Math.sqrt(Math.pow(t-e,2)+Math.pow(a-s,2))).toFixed(1);return c?(0,a.jsx)(d.Zb,{className:"glass dark:glass-dark",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"})})}):0===s.length?(0,a.jsxs)(d.Zb,{className:"glass dark:glass-dark",children:[(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{children:"Available Rides"}),(0,a.jsx)(d.SZ,{children:"No ride requests at the moment"})]}),(0,a.jsxs)(d.aY,{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-6xl mb-4 animate-pulse-glow",children:"\uD83D\uDE97"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Waiting for ride requests..."})]})]}):(0,a.jsxs)(d.Zb,{className:"glass dark:glass-dark",children:[(0,a.jsxs)(d.Ol,{children:[(0,a.jsxs)(d.ll,{className:"flex items-center justify-between",children:["Available Rides",(0,a.jsxs)(Z.C,{className:"bg-green-500/10 text-green-500",children:[s.length," requests"]})]}),(0,a.jsx)(d.SZ,{children:"Accept rides and start earning"})]}),(0,a.jsx)(d.aY,{className:"space-y-4",children:s.map(e=>{var s,t;return(0,a.jsxs)("div",{className:"p-4 rounded-lg border bg-card/50 hover:bg-card transition-all hover:shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:null===(s=e.user)||void 0===s?void 0:s.full_name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,a.jsx)(b.Z,{className:"w-3 h-3"}),new Date(e.requested_at).toLocaleTimeString()]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-bold text-lg text-primary",children:["$",null===(t=e.fare_amount)||void 0===t?void 0:t.toFixed(2)]}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[m(e.pickup_latitude,e.pickup_longitude,e.dropoff_latitude,e.dropoff_longitude)," km"]})]})]}),(0,a.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mt-0.5 text-green-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Pickup"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.pickup_address||"".concat(e.pickup_latitude.toFixed(4),", ").concat(e.pickup_longitude.toFixed(4))})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.Z,{className:"w-4 h-4 mt-0.5 text-red-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Destination"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:e.dropoff_address||"".concat(e.dropoff_latitude.toFixed(4),", ").concat(e.dropoff_longitude.toFixed(4))})]})]})]}),(0,a.jsxs)(r.z,{onClick:()=>o(e.id),className:"w-full",children:[(0,a.jsx)(M.Z,{className:"w-4 h-4 mr-2"}),"Accept Ride"]})]},e.id)})})]})}var I=t(2991),U=t(4530),L=t(1045);let T=L.fC;L.xz;let H=L.h_;L.x8;let $=i.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(L.aV,{ref:s,className:(0,Y.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l})});$.displayName=L.aV.displayName;let B=i.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsxs)(H,{children:[(0,a.jsx)($,{}),(0,a.jsxs)(L.VY,{ref:s,className:(0,Y.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[l,(0,a.jsxs)(L.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});B.displayName=L.VY.displayName;let V=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,Y.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};V.displayName="DialogHeader";let W=i.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(L.Dx,{ref:s,className:(0,Y.cn)("text-lg font-semibold leading-none tracking-tight",t),...l})});W.displayName=L.Dx.displayName;let Q=i.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(L.dk,{ref:s,className:(0,Y.cn)("text-sm text-muted-foreground",t),...l})});function G(){var e,s,t,c,n,x,o,m,u;let{user:h}=(0,l.a)(),[p,j]=(0,i.useState)(null),[N,v]=(0,i.useState)(!0),[b,w]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(!(null==h?void 0:h.id))return;k();let e=g.O.channel("driver_active_ride").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:"driver_id=eq.".concat(null==h?void 0:h.id)},()=>{k()}).subscribe();return()=>{e.unsubscribe()}},[null==h?void 0:h.id]);let k=async()=>{if(!h)return;let{data:e,error:s}=await g.O.from("rides").select("*, user:profiles!rides_user_id_fkey(*)").eq("driver_id",h.id).in("status",["accepted","in_progress"]).order("accepted_at",{ascending:!1}).limit(1).maybeSingle();e&&j(e),v(!1)},S=async()=>{if(!p)return;let{error:e}=await g.O.from("rides").update({status:"in_progress",started_at:new Date().toISOString()}).eq("id",p.id);e?f.Am.error("Failed to start ride"):f.Am.success("Ride started!")},A=async()=>{if(!p)return;let{error:e}=await g.O.from("rides").update({status:"completed",completed_at:new Date().toISOString(),payment_status:"completed"}).eq("id",p.id);e?f.Am.error("Failed to complete ride"):(f.Am.success("Ride completed!"),w(!1),j(null))};return N?(0,a.jsx)(d.Zb,{className:"glass dark:glass-dark",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto"})})}):p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(d.Zb,{className:"glass dark:glass-dark",children:[(0,a.jsx)(d.Ol,{children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.ll,{children:"Current Ride"}),(0,a.jsxs)(d.SZ,{children:["Ride #",p.id.slice(0,8)]})]}),(0,a.jsx)(Z.C,{className:"accepted"===p.status?"bg-blue-500/10 text-blue-500":"bg-green-500/10 text-green-500",children:"accepted"===p.status?"En Route":"In Progress"})]})}),(0,a.jsxs)(d.aY,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 rounded-lg bg-muted/50",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center",children:(null===(e=p.user)||void 0===e?void 0:e.avatar_url)?(0,a.jsx)("img",{src:p.user.avatar_url,alt:(null===(s=p.user)||void 0===s?void 0:s.full_name)||"User",className:"w-full h-full rounded-full"}):(0,a.jsx)("span",{className:"text-lg font-bold",children:(null===(c=p.user)||void 0===c?void 0:null===(t=c.full_name)||void 0===t?void 0:t[0])||"?"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:null===(n=p.user)||void 0===n?void 0:n.full_name}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[(0,a.jsx)(F.Z,{className:"w-3 h-3 fill-yellow-500 text-yellow-500"}),(null===(o=p.user)||void 0===o?void 0:null===(x=o.rating)||void 0===x?void 0:x.toFixed(1))||"N/A"]})]})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.Z,{className:"w-5 h-5 mt-0.5 text-green-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Pickup"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:p.pickup_address||"".concat(p.pickup_latitude.toFixed(4),", ").concat(p.pickup_longitude.toFixed(4))})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(_.Z,{className:"w-5 h-5 mt-0.5 text-red-500"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Destination"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:p.dropoff_address||"".concat(p.dropoff_latitude.toFixed(4),", ").concat(p.dropoff_longitude.toFixed(4))})]})]})]}),(0,a.jsxs)("div",{className:"pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Fare Amount"}),(0,a.jsxs)("span",{className:"text-2xl font-bold text-primary",children:["$",null===(m=p.fare_amount)||void 0===m?void 0:m.toFixed(2)]})]}),"accepted"===p.status?(0,a.jsxs)(r.z,{onClick:S,className:"w-full",size:"lg",children:[(0,a.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Start Ride"]}):(0,a.jsxs)(r.z,{onClick:()=>w(!0),className:"w-full",size:"lg",children:[(0,a.jsx)(U.Z,{className:"w-4 h-4 mr-2"}),"Complete Ride"]})]})]})]}),(0,a.jsx)(d.Zb,{className:"glass dark:glass-dark overflow-hidden",children:(0,a.jsx)(d.aY,{className:"p-0",children:(0,a.jsx)(I.G,{className:"h-[400px] rounded-lg",showDirections:!0,origin:{lat:p.pickup_latitude,lng:p.pickup_longitude},destination:{lat:p.dropoff_latitude,lng:p.dropoff_longitude},markers:[{lat:p.pickup_latitude,lng:p.pickup_longitude,label:"A",title:p.pickup_address||"Pickup"},{lat:p.dropoff_latitude,lng:p.dropoff_longitude,label:"B",title:p.dropoff_address||"Destination"}]})})})]}),(0,a.jsx)(T,{open:b,onOpenChange:w,children:(0,a.jsxs)(B,{children:[(0,a.jsxs)(V,{children:[(0,a.jsx)(W,{children:"Complete Ride"}),(0,a.jsx)(Q,{children:"Mark this ride as completed and collect payment"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 rounded-lg bg-muted",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm",children:"Total Fare"}),(0,a.jsxs)("span",{className:"text-2xl font-bold",children:["$",null===(u=p.fare_amount)||void 0===u?void 0:u.toFixed(2)]})]})}),(0,a.jsx)(r.z,{onClick:A,className:"w-full",size:"lg",children:"Confirm & Complete"})]})]})})]}):(0,a.jsxs)(d.Zb,{className:"glass dark:glass-dark",children:[(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{children:"Active Ride"}),(0,a.jsx)(d.SZ,{children:"No active ride at the moment"})]}),(0,a.jsxs)(d.aY,{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAF"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Accept a ride to get started"})]})]})}Q.displayName=L.dk.displayName;var J=t(5790);function K(){let{user:e}=(0,l.a)(),[s,t]=(0,i.useState)({totalEarnings:0,totalRides:0,avgRating:0,totalHours:0});(0,i.useEffect)(()=>{r()},[null==e?void 0:e.id]);let r=async()=>{if(!(null==e?void 0:e.id))return;let{data:s}=await g.O.from("rides").select("fare_amount, driver_rating, duration_minutes").eq("driver_id",e.id).eq("status","completed");if(s){let e=s.reduce((e,s)=>e+(s.fare_amount||0),0),a=s.length,l=s.filter(e=>e.driver_rating),i=l.length>0?l.reduce((e,s)=>e+(s.driver_rating||0),0)/l.length:0,r=s.reduce((e,s)=>e+(s.duration_minutes||0),0);t({totalEarnings:e,totalRides:a,avgRating:i,totalHours:Math.round(r/60)})}};return(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[(0,a.jsx)(d.ll,{className:"text-[15px] font-medium text-gray-700",children:"Total Earnings"}),(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:(0,a.jsx)(w.Z,{className:"h-5 w-5 text-green-600"})})]}),(0,a.jsxs)(d.aY,{children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:["$",s.totalEarnings.toFixed(2)]}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500 mt-1",children:"From completed rides"})]})]}),(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[(0,a.jsx)(d.ll,{className:"text-[15px] font-medium text-gray-700",children:"Total Rides"}),(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(J.Z,{className:"h-5 w-5 text-blue-600"})})]}),(0,a.jsxs)(d.aY,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:s.totalRides}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500 mt-1",children:"Completed successfully"})]})]}),(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[(0,a.jsx)(d.ll,{className:"text-[15px] font-medium text-gray-700",children:"Average Rating"}),(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center",children:(0,a.jsx)(F.Z,{className:"h-5 w-5 text-yellow-500 fill-yellow-500"})})]}),(0,a.jsxs)(d.aY,{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:s.avgRating.toFixed(1)}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500 mt-1",children:"From passenger reviews"})]})]}),(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-3",children:[(0,a.jsx)(d.ll,{className:"text-[15px] font-medium text-gray-700",children:"Hours Driven"}),(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"h-5 w-5 text-purple-600"})})]}),(0,a.jsxs)(d.aY,{children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:[s.totalHours,"h"]}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500 mt-1",children:"Total time on road"})]})]})]})}function X(){let{profile:e,signOut:s,user:t}=(0,l.a)(),[r,c]=(0,i.useState)(null),[n,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{u()},[null==t?void 0:t.id]);let u=async()=>{if(!(null==t?void 0:t.id))return;let{data:e,error:s}=await g.O.from("driver_profiles").select("*").eq("id",t.id).maybeSingle();if(e)c(e),m(e.is_available);else if(!e&&!s){let{error:e}=await g.O.from("driver_profiles").insert([{id:t.id,vehicle_type:"standard",is_available:!1}]);e||u()}},h=async e=>{if(!(null==t?void 0:t.id))return;let{error:s}=await g.O.from("driver_profiles").update({is_available:e}).eq("id",t.id);s?f.Am.error("Failed to update availability"):(m(e),f.Am.success(e?"You are now available":"You are now offline"))};return(0,a.jsxs)("div",{className:"min-h-screen bg-[#F2F2F7] pb-20",children:[(0,a.jsx)("div",{className:"ios-navbar",children:(0,a.jsx)("div",{className:"container mx-auto px-4 max-w-6xl",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-14",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900",children:"Driver"})})})}),(0,a.jsxs)("div",{className:"container mx-auto p-4 max-w-6xl space-y-4",children:[(0,a.jsxs)("div",{className:"ios-list rounded-xl overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-white px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:(null==e?void 0:e.avatar_url)?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)(o.Z,{className:"w-8 h-8 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:(null==e?void 0:e.full_name)||"Driver"}),(0,a.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full bg-blue-100 text-blue-700",children:"Driver"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-0.5",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(F.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),(null==e?void 0:e.rating)?e.rating.toFixed(1):"0.0"]}),(0,a.jsx)("span",{className:"text-gray-300",children:"•"}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4"}),(null==e?void 0:e.total_rides)||0," rides"]})]})]}),(0,a.jsx)(R.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),(0,a.jsx)("div",{className:"ios-separator mx-4"}),(0,a.jsxs)("div",{className:"ios-list-item flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full flex items-center justify-center ".concat(n?"bg-green-100":"bg-gray-100"),children:(0,a.jsx)(o.Z,{className:"w-4 h-4 ".concat(n?"text-green-600":"text-gray-500")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[17px] font-medium text-gray-900",children:n?"Available for Rides":"Currently Offline"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:n?"You can accept rides":"Turn on to start earning"})]})]}),(0,a.jsx)(E,{id:"availability",checked:n,onCheckedChange:h,className:"data-[state=checked]:bg-[#34C759]"})]}),(0,a.jsx)("div",{className:"ios-separator mx-4"}),(0,a.jsxs)("button",{onClick:s,className:"ios-list-item w-full flex items-center justify-between text-left",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full bg-red-100 flex items-center justify-center",children:(0,a.jsx)(O.Z,{className:"w-4 h-4 text-red-600"})}),(0,a.jsx)("span",{className:"text-[17px] text-red-600 font-normal",children:"Sign Out"})]}),(0,a.jsx)(R.Z,{className:"w-5 h-5 text-gray-400"})]})]}),(0,a.jsxs)(x.mQ,{defaultValue:"active",className:"space-y-4",children:[(0,a.jsx)("div",{className:"ios-segment",children:(0,a.jsxs)(x.dr,{className:"w-full grid grid-cols-3 bg-transparent p-0 h-auto",children:[(0,a.jsx)(x.SP,{value:"active",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Active Ride"}),(0,a.jsx)(x.SP,{value:"available",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Available"}),(0,a.jsx)(x.SP,{value:"stats",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Stats"})]})}),(0,a.jsx)(x.nU,{value:"active",className:"mt-4",children:(0,a.jsx)(G,{})}),(0,a.jsx)(x.nU,{value:"available",className:"mt-4",children:n?(0,a.jsx)(z,{}):(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.aY,{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDE97"}),(0,a.jsx)("p",{className:"text-lg font-medium mb-2 text-gray-900",children:"You are currently offline"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4 text-[15px]",children:"Turn on availability to start accepting rides"})]})})}),(0,a.jsx)(x.nU,{value:"stats",className:"mt-4",children:(0,a.jsx)(K,{})})]})]})]})}function ee(e){let{className:s,variant:t="default",animation:l="shimmer",...i}=e;return(0,a.jsx)("div",{className:(0,Y.cn)("bg-muted/50 rounded-lg",{default:"h-4 w-full",card:"h-32 w-full rounded-2xl",text:"h-3 w-3/4",circle:"h-12 w-12 rounded-full",button:"h-12 w-full rounded-full"}[t],{pulse:"animate-pulse",shimmer:"loading-shimmer",none:""}[l],s),...i})}function es(){return(0,a.jsxs)("div",{className:"native-card p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ee,{variant:"circle",className:"h-10 w-10"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(ee,{className:"h-4 w-1/3"}),(0,a.jsx)(ee,{className:"h-3 w-1/2"})]})]}),(0,a.jsx)(ee,{variant:"card",className:"h-24"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee,{className:"h-3 w-full"}),(0,a.jsx)(ee,{className:"h-3 w-4/5"})]})]})}function et(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"native-card p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(ee,{variant:"circle",className:"h-16 w-16"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(ee,{className:"h-5 w-32"}),(0,a.jsx)(ee,{className:"h-4 w-24"})]})]}),(0,a.jsx)(ee,{variant:"button",className:"h-10 w-24"})]})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(ee,{variant:"button",className:"h-10 w-24"}),(0,a.jsx)(ee,{variant:"button",className:"h-10 w-24"}),(0,a.jsx)(ee,{variant:"button",className:"h-10 w-24"})]}),(0,a.jsx)(es,{}),(0,a.jsx)(es,{})]})}function ea(){let{user:e,profile:s,loading:t}=(0,l.a)(),[r,c]=(0,i.useState)(!1);return((0,i.useEffect)(()=>{c(!0)},[]),t||!r)?(0,a.jsx)("div",{className:"min-h-screen bg-[#1a1d1f] flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"w-full max-w-6xl",children:(0,a.jsx)(et,{})})}):e&&s?(0,a.jsx)("div",{className:"min-h-screen bg-[#F2F2F7]",children:"driver"===s.role?(0,a.jsx)(X,{}):(0,a.jsx)(q,{})}):(0,a.jsx)("div",{className:"min-h-screen bg-[#F2F2F7] flex items-center justify-center p-4",children:(0,a.jsx)(j,{})})}}},function(e){e.O(0,[736,592,744],function(){return e(e.s=6913)}),_N_E=e.O()}]);