"use strict";exports.id=779,exports.ids=[779],exports.modules={8779:(e,s,t)=>{t.r(s),t.d(s,{UserDashboard:()=>S});var a=t(80),l=t(6904),r=t(9885),i=t(7988),c=t(8384),d=t(7052),n=t(4868),x=t(2410),o=t(5441),m=t(6583),u=t(8334),h=t(9941);function j(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)(null),[j,p]=(0,r.useState)(null),[g,f]=(0,r.useState)(!1),[N,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),[w,_]=(0,r.useState)(null),[k,Z]=(0,r.useState)(null);(0,r.useEffect)(()=>{s&&j?F():(v(null),_(null),Z(null))},[s,j]);let F=async()=>{if(s&&j){b(!0);try{let e=(j.lat-s.lat)*Math.PI/180,t=(j.lng-s.lng)*Math.PI/180,a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(j.lat*Math.PI/180)*Math.sin(t/2)*Math.sin(t/2),l=6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))),r=5+2.5*l,i=Math.round(l/40*60);Z(l),v(r),_(i)}catch(e){console.error("Error calculating estimate:",e),h.Am.error("Failed to calculate estimate")}finally{b(!1)}}},S=async()=>{if(!s||!j){h.Am.error("Please select both pickup and dropoff locations");return}if(!e){h.Am.error("Please sign in to book a ride");return}f(!0);try{let{data:a,error:l}=await i.O.from("rides").insert([{user_id:e.id,pickup_latitude:s.lat,pickup_longitude:s.lng,pickup_address:s.address||`${s.lat}, ${s.lng}`,dropoff_latitude:j.lat,dropoff_longitude:j.lng,dropoff_address:j.address||`${j.lat}, ${j.lng}`,fare_amount:y,status:"requested"}]).select().single();if(l)throw l;h.Am.success("Ride requested!",{description:"Finding a driver nearby..."}),t(null),p(null),v(null),_(null),Z(null)}catch(e){console.error(e),h.Am.error("Failed to book ride",{description:"Please try again"})}finally{f(!1)}};return a.jsx("div",{className:"space-y-4",children:(0,a.jsxs)(d.Zb,{className:"ios-card overflow-hidden",children:[a.jsx(d.Ol,{className:"pb-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx(d.ll,{className:"text-xl font-semibold text-gray-900",children:"Book a Ride"}),a.jsx(d.SZ,{className:"text-[15px] text-gray-600 mt-0.5",children:"Where would you like to go?"})]}),y&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-[#007AFF]",children:["$",y.toFixed(2)]}),w&&(0,a.jsxs)("div",{className:"text-[13px] text-gray-500 flex items-center gap-1 justify-end",children:[a.jsx(o.Z,{className:"w-3.5 h-3.5"}),w," min"]})]})]})}),(0,a.jsxs)(d.aY,{className:"space-y-6 p-4",children:[a.jsx("div",{children:a.jsx(n._,{onLocationSelect:t,label:"Pickup Location",placeholder:"Where should we pick you up?",initialLocation:s||void 0})}),a.jsx("div",{children:a.jsx(n._,{onLocationSelect:p,label:"Destination",placeholder:"Where are you going?",initialLocation:j||void 0})}),s&&j&&(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[a.jsx(m.Z,{className:"w-4 h-4"}),"Your Route"]}),a.jsx(x.P,{pickup:s,destination:j,showDetails:!1})]}),y&&!N&&a.jsx("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"text-[13px] text-gray-600 mb-1",children:"Estimated Fare"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-[#007AFF]",children:["$",y.toFixed(2)]})]}),w&&(0,a.jsxs)("div",{className:"text-right",children:[a.jsx("p",{className:"text-[13px] text-gray-600 mb-1",children:"Duration"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900 flex items-center gap-1",children:[a.jsx(o.Z,{className:"w-4 h-4"}),w," min"]})]})]}),k&&a.jsx("div",{className:"pt-2 border-t border-blue-300",children:(0,a.jsxs)("p",{className:"text-[13px] text-gray-600",children:["Distance: ",k.toFixed(2)," km"]})})]})}),a.jsx(c.z,{onClick:S,disabled:g||N||!s||!j,className:"w-full ios-button-primary text-[17px] h-12",children:g?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[a.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Booking..."]}):(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(u.Z,{className:"w-5 h-5"}),y?`Book Ride - $${y.toFixed(2)}`:"Select Locations to Book"]})})]})]})})}var p=t(4796),g=t(7094),f=t(3680),N=t(7932),b=t(6908),y=t(6206);function v(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)([]),[n,x]=(0,r.useState)(!0);(0,r.useEffect)(()=>{m();let s=i.O.channel("active_rides").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:`user_id=eq.${e?.id}`},()=>{m()}).subscribe();return()=>{s.unsubscribe()}},[e?.id]);let m=async()=>{if(!e)return;let{data:s,error:a}=await i.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["requested","accepted","in_progress"]).order("created_at",{ascending:!1});s&&t(s),x(!1)},u=async e=>{let{error:s}=await i.O.from("rides").update({status:"cancelled"}).eq("id",e);s?h.Am.error("Failed to cancel ride"):h.Am.success("Ride cancelled")},j=e=>{switch(e){case"requested":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"accepted":return"bg-blue-100 text-blue-700 border-blue-200";case"in_progress":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},v=e=>{switch(e){case"requested":return"Finding Driver";case"accepted":return"Driver En Route";case"in_progress":return"In Progress";default:return e}};return n?a.jsx(d.Zb,{className:"ios-card",children:a.jsx(d.aY,{className:"p-8 text-center",children:a.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?a.jsx(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[a.jsx(d.ll,{className:"text-gray-900",children:"Active Rides"}),a.jsx(d.SZ,{className:"text-gray-600",children:"No active rides at the moment"})]})}):a.jsx("div",{className:"space-y-4",children:s.map(e=>(0,a.jsxs)(d.Zb,{className:"ios-card",children:[a.jsx(d.Ol,{className:"border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d.ll,{className:"text-lg font-semibold text-gray-900",children:["Ride #",e.id.slice(0,8)]}),(0,a.jsxs)(d.SZ,{className:"flex items-center gap-2 mt-1 text-gray-600",children:[a.jsx(o.Z,{className:"w-3.5 h-3.5"}),new Date(e.requested_at).toLocaleTimeString()]})]}),a.jsx(p.C,{className:`${j(e.status)} text-[13px] px-2 py-1 rounded-md font-medium border`,children:v(e.status)})]})}),(0,a.jsxs)(d.aY,{className:"space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx(g.Z,{className:"w-4 h-4 text-green-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"text-[15px] font-medium text-gray-900",children:"Pickup"}),a.jsx("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.pickup_address||`${e.pickup_latitude.toFixed(4)}, ${e.pickup_longitude.toFixed(4)}`})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx(g.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"text-[15px] font-medium text-gray-900",children:"Destination"}),a.jsx("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.dropoff_address||`${e.dropoff_latitude.toFixed(4)}, ${e.dropoff_longitude.toFixed(4)}`})]})]})]}),e.driver&&(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-50 flex items-center gap-3 border border-gray-200",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.driver.avatar_url?a.jsx("img",{src:e.driver.avatar_url,alt:e.driver.full_name,className:"w-full h-full object-cover"}):a.jsx(f.Z,{className:"w-6 h-6 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1",children:[a.jsx("p",{className:"font-medium text-gray-900 text-[17px]",children:e.driver.full_name}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-0.5",children:[a.jsx(N.Z,{className:"w-3.5 h-3.5 fill-yellow-500 text-yellow-500"}),a.jsx("span",{className:"text-[13px] text-gray-600",children:e.driver.rating.toFixed(1)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(b.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",e.fare_amount?.toFixed(2)]})]}),"requested"===e.status&&(0,a.jsxs)(c.z,{variant:"destructive",size:"sm",onClick:()=>u(e.id),className:"bg-red-600 hover:bg-red-700 text-white rounded-lg text-[15px] h-9 px-4",children:[a.jsx(y.Z,{className:"w-4 h-4 mr-1"}),"Cancel"]})]})]})]},e.id))})}var w=t(517);function _(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)([]),[c,n]=(0,r.useState)(!0);(0,r.useEffect)(()=>{x()},[e?.id]);let x=async()=>{if(!e)return;let{data:s,error:a}=await i.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["completed","cancelled"]).order("created_at",{ascending:!1}).limit(10);s&&t(s),n(!1)};return c?a.jsx(d.Zb,{className:"ios-card",children:a.jsx(d.aY,{className:"p-8 text-center",children:a.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?a.jsx(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[a.jsx(d.ll,{className:"text-gray-900",children:"Ride History"}),a.jsx(d.SZ,{className:"text-gray-600 text-[15px]",children:"No completed rides yet"})]})}):(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"border-b border-gray-200",children:[a.jsx(d.ll,{className:"text-gray-900 text-xl font-semibold",children:"Ride History"}),a.jsx(d.SZ,{className:"text-gray-600 text-[15px]",children:"Your recent trips"})]}),a.jsx(d.aY,{className:"p-0",children:a.jsx("div",{className:"divide-y divide-gray-200",children:s.map(e=>(0,a.jsxs)("div",{className:"p-4 bg-white hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center",children:a.jsx(w.Z,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 text-[17px]",children:new Date(e.completed_at||e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),a.jsx("p",{className:"text-[13px] text-gray-500",children:new Date(e.completed_at||e.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]})]}),a.jsx(p.C,{className:`text-[13px] px-2 py-1 rounded-md font-medium border ${"completed"===e.status?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"}`,children:e.status})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx(g.Z,{className:"w-3.5 h-3.5 text-green-600"})}),a.jsx("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.pickup_address||"Pickup location"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:a.jsx(g.Z,{className:"w-3.5 h-3.5 text-blue-600"})}),a.jsx("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.dropoff_address||"Drop-off location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:a.jsx(b.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",e.fare_amount?.toFixed(2)]})]}),e.driver&&"completed"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-50",children:[a.jsx(N.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),a.jsx("span",{className:"text-[15px] font-medium text-gray-900",children:e.driver_rating||"Not rated"})]})]})]},e.id))})})]})}var k=t(1922),Z=t(92),F=t(999);function S(){let{profile:e,signOut:s}=(0,l.a)();return a.jsx("div",{className:"min-h-screen bg-[#F2F2F7] pb-20",children:(0,a.jsxs)("div",{className:"container mx-auto p-4 max-w-6xl space-y-4",children:[(0,a.jsxs)("div",{className:"ios-list rounded-xl overflow-hidden",children:[a.jsx("div",{className:"bg-white px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:e?.avatar_url?a.jsx("img",{src:e.avatar_url,alt:e.full_name,className:"w-full h-full object-cover"}):a.jsx(f.Z,{className:"w-8 h-8 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:e?.full_name||"User"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-0.5",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[a.jsx(N.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),e?.rating?e.rating.toFixed(1):"0.0"]}),a.jsx("span",{className:"text-gray-300",children:"•"}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[a.jsx(g.Z,{className:"w-4 h-4"}),e?.total_rides||0," rides"]})]})]}),a.jsx(k.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),a.jsx("div",{className:"ios-separator mx-4"}),(0,a.jsxs)("button",{onClick:s,className:"ios-list-item w-full flex items-center justify-between text-left",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-7 h-7 rounded-full bg-red-100 flex items-center justify-center",children:a.jsx(Z.Z,{className:"w-4 h-4 text-red-600"})}),a.jsx("span",{className:"text-[17px] text-red-600 font-normal",children:"Sign Out"})]}),a.jsx(k.Z,{className:"w-5 h-5 text-gray-400"})]})]}),(0,a.jsxs)(F.mQ,{defaultValue:"book",className:"space-y-4",children:[a.jsx("div",{className:"ios-segment",children:(0,a.jsxs)(F.dr,{className:"w-full grid grid-cols-3 bg-transparent p-0 h-auto",children:[a.jsx(F.SP,{value:"book",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Book Ride"}),a.jsx(F.SP,{value:"active",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Active"}),a.jsx(F.SP,{value:"history",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"History"})]})}),a.jsx(F.nU,{value:"book",className:"mt-4 space-y-4",children:a.jsx(j,{})}),a.jsx(F.nU,{value:"active",className:"mt-4",children:a.jsx(v,{})}),a.jsx(F.nU,{value:"history",className:"mt-4",children:a.jsx(_,{})})]})]})})}}};