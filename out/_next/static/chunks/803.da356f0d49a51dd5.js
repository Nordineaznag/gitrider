"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{4803:function(e,s,t){t.r(s),t.d(s,{UserDashboard:function(){return S}});var a=t(7437),l=t(5806),r=t(2265),i=t(6763),c=t(3023),d=t(6110),n=t(4461),x=t(592),o=t(6141),m=t(2682),u=t(9251),h=t(1424);function j(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)(null),[j,p]=(0,r.useState)(null),[f,g]=(0,r.useState)(!1),[N,v]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[w,_]=(0,r.useState)(null),[k,Z]=(0,r.useState)(null);(0,r.useEffect)(()=>{s&&j?F():(y(null),_(null),Z(null))},[s,j]);let F=async()=>{if(s&&j){v(!0);try{let e=(j.lat-s.lat)*Math.PI/180,t=(j.lng-s.lng)*Math.PI/180,a=Math.sin(e/2)*Math.sin(e/2)+Math.cos(s.lat*Math.PI/180)*Math.cos(j.lat*Math.PI/180)*Math.sin(t/2)*Math.sin(t/2),l=6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))),r=5+2.5*l,i=Math.round(l/40*60);Z(l),y(r),_(i)}catch(e){console.error("Error calculating estimate:",e),h.Am.error("Failed to calculate estimate")}finally{v(!1)}}},S=async()=>{if(!s||!j){h.Am.error("Please select both pickup and dropoff locations");return}if(!e){h.Am.error("Please sign in to book a ride");return}g(!0);try{let{data:a,error:l}=await i.O.from("rides").insert([{user_id:e.id,pickup_latitude:s.lat,pickup_longitude:s.lng,pickup_address:s.address||"".concat(s.lat,", ").concat(s.lng),dropoff_latitude:j.lat,dropoff_longitude:j.lng,dropoff_address:j.address||"".concat(j.lat,", ").concat(j.lng),fare_amount:b,status:"requested"}]).select().single();if(l)throw l;h.Am.success("Ride requested!",{description:"Finding a driver nearby..."}),t(null),p(null),y(null),_(null),Z(null)}catch(e){console.error(e),h.Am.error("Failed to book ride",{description:"Please try again"})}finally{g(!1)}};return(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(d.Zb,{className:"ios-card overflow-hidden",children:[(0,a.jsx)(d.Ol,{className:"pb-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(d.ll,{className:"text-xl font-semibold text-gray-900",children:"Book a Ride"}),(0,a.jsx)(d.SZ,{className:"text-[15px] text-gray-600 mt-0.5",children:"Where would you like to go?"})]}),b&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-[#007AFF]",children:["$",b.toFixed(2)]}),w&&(0,a.jsxs)("div",{className:"text-[13px] text-gray-500 flex items-center gap-1 justify-end",children:[(0,a.jsx)(o.Z,{className:"w-3.5 h-3.5"}),w," min"]})]})]})}),(0,a.jsxs)(d.aY,{className:"space-y-6 p-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)(n._,{onLocationSelect:t,label:"Pickup Location",placeholder:"Where should we pick you up?",initialLocation:s||void 0})}),(0,a.jsx)("div",{children:(0,a.jsx)(n._,{onLocationSelect:p,label:"Destination",placeholder:"Where are you going?",initialLocation:j||void 0})}),s&&j&&(0,a.jsxs)("div",{className:"border-t pt-4",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"w-4 h-4"}),"Your Route"]}),(0,a.jsx)(x.P,{pickup:s,destination:j,showDetails:!1})]}),b&&!N&&(0,a.jsx)("div",{className:"p-4 rounded-lg bg-blue-50 border border-blue-200",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mb-1",children:"Estimated Fare"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-[#007AFF]",children:["$",b.toFixed(2)]})]}),w&&(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mb-1",children:"Duration"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-gray-900 flex items-center gap-1",children:[(0,a.jsx)(o.Z,{className:"w-4 h-4"}),w," min"]})]})]}),k&&(0,a.jsx)("div",{className:"pt-2 border-t border-blue-300",children:(0,a.jsxs)("p",{className:"text-[13px] text-gray-600",children:["Distance: ",k.toFixed(2)," km"]})})]})}),(0,a.jsx)(c.z,{onClick:S,disabled:f||N||!s||!j,className:"w-full ios-button-primary text-[17px] h-12",children:f?(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Booking..."]}):(0,a.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5"}),b?"Book Ride - $".concat(b.toFixed(2)):"Select Locations to Book"]})})]})]})})}var p=t(9155),f=t(6142),g=t(7972),N=t(5340),v=t(1298),b=t(2549);function y(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)([]),[n,x]=(0,r.useState)(!0);(0,r.useEffect)(()=>{m();let s=i.O.channel("active_rides").on("postgres_changes",{event:"*",schema:"public",table:"rides",filter:"user_id=eq.".concat(null==e?void 0:e.id)},()=>{m()}).subscribe();return()=>{s.unsubscribe()}},[null==e?void 0:e.id]);let m=async()=>{if(!e)return;let{data:s,error:a}=await i.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["requested","accepted","in_progress"]).order("created_at",{ascending:!1});s&&t(s),x(!1)},u=async e=>{let{error:s}=await i.O.from("rides").update({status:"cancelled"}).eq("id",e);s?h.Am.error("Failed to cancel ride"):h.Am.success("Ride cancelled")},j=e=>{switch(e){case"requested":return"bg-yellow-100 text-yellow-700 border-yellow-200";case"accepted":return"bg-blue-100 text-blue-700 border-blue-200";case"in_progress":return"bg-green-100 text-green-700 border-green-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},y=e=>{switch(e){case"requested":return"Finding Driver";case"accepted":return"Driver En Route";case"in_progress":return"In Progress";default:return e}};return n?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{className:"text-gray-900",children:"Active Rides"}),(0,a.jsx)(d.SZ,{className:"text-gray-600",children:"No active rides at the moment"})]})}):(0,a.jsx)("div",{className:"space-y-4",children:s.map(e=>{var s;return(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsx)(d.Ol,{className:"border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)(d.ll,{className:"text-lg font-semibold text-gray-900",children:["Ride #",e.id.slice(0,8)]}),(0,a.jsxs)(d.SZ,{className:"flex items-center gap-2 mt-1 text-gray-600",children:[(0,a.jsx)(o.Z,{className:"w-3.5 h-3.5"}),new Date(e.requested_at).toLocaleTimeString()]})]}),(0,a.jsx)(p.C,{className:"".concat(j(e.status)," text-[13px] px-2 py-1 rounded-md font-medium border"),children:y(e.status)})]})}),(0,a.jsxs)(d.aY,{className:"space-y-4 p-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(f.Z,{className:"w-4 h-4 text-green-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[15px] font-medium text-gray-900",children:"Pickup"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.pickup_address||"".concat(e.pickup_latitude.toFixed(4),", ").concat(e.pickup_longitude.toFixed(4))})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(f.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-[15px] font-medium text-gray-900",children:"Destination"}),(0,a.jsx)("p",{className:"text-[13px] text-gray-600 mt-0.5",children:e.dropoff_address||"".concat(e.dropoff_latitude.toFixed(4),", ").concat(e.dropoff_longitude.toFixed(4))})]})]})]}),e.driver&&(0,a.jsxs)("div",{className:"p-3 rounded-lg bg-gray-50 flex items-center gap-3 border border-gray-200",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.driver.avatar_url?(0,a.jsx)("img",{src:e.driver.avatar_url,alt:e.driver.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)(g.Z,{className:"w-6 h-6 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-[17px]",children:e.driver.full_name}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-0.5",children:[(0,a.jsx)(N.Z,{className:"w-3.5 h-3.5 fill-yellow-500 text-yellow-500"}),(0,a.jsx)("span",{className:"text-[13px] text-gray-600",children:e.driver.rating.toFixed(1)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",null===(s=e.fare_amount)||void 0===s?void 0:s.toFixed(2)]})]}),"requested"===e.status&&(0,a.jsxs)(c.z,{variant:"destructive",size:"sm",onClick:()=>u(e.id),className:"bg-red-600 hover:bg-red-700 text-white rounded-lg text-[15px] h-9 px-4",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4 mr-1"}),"Cancel"]})]})]})]},e.id)})})}var w=t(8203);function _(){let{user:e}=(0,l.a)(),[s,t]=(0,r.useState)([]),[c,n]=(0,r.useState)(!0);(0,r.useEffect)(()=>{x()},[null==e?void 0:e.id]);let x=async()=>{if(!e)return;let{data:s,error:a}=await i.O.from("rides").select("*, driver:profiles!rides_driver_id_fkey(*)").eq("user_id",e.id).in("status",["completed","cancelled"]).order("created_at",{ascending:!1}).limit(10);s&&t(s),n(!1)};return c?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsx)(d.aY,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"animate-spin w-8 h-8 border-4 border-[#007AFF] border-t-transparent rounded-full mx-auto"})})}):0===s.length?(0,a.jsx)(d.Zb,{className:"ios-card",children:(0,a.jsxs)(d.Ol,{children:[(0,a.jsx)(d.ll,{className:"text-gray-900",children:"Ride History"}),(0,a.jsx)(d.SZ,{className:"text-gray-600 text-[15px]",children:"No completed rides yet"})]})}):(0,a.jsxs)(d.Zb,{className:"ios-card",children:[(0,a.jsxs)(d.Ol,{className:"border-b border-gray-200",children:[(0,a.jsx)(d.ll,{className:"text-gray-900 text-xl font-semibold",children:"Ride History"}),(0,a.jsx)(d.SZ,{className:"text-gray-600 text-[15px]",children:"Your recent trips"})]}),(0,a.jsx)(d.aY,{className:"p-0",children:(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:s.map(e=>{var s;return(0,a.jsxs)("div",{className:"p-4 bg-white hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-9 h-9 rounded-full bg-gray-100 flex items-center justify-center",children:(0,a.jsx)(w.Z,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 text-[17px]",children:new Date(e.completed_at||e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,a.jsx)("p",{className:"text-[13px] text-gray-500",children:new Date(e.completed_at||e.created_at).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"})})]})]}),(0,a.jsx)(p.C,{className:"text-[13px] px-2 py-1 rounded-md font-medium border ".concat("completed"===e.status?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"),children:e.status})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(f.Z,{className:"w-3.5 h-3.5 text-green-600"})}),(0,a.jsx)("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.pickup_address||"Pickup location"})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)(f.Z,{className:"w-3.5 h-3.5 text-blue-600"})}),(0,a.jsx)("span",{className:"text-[15px] text-gray-700 line-clamp-1",children:e.dropoff_address||"Drop-off location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["$",null===(s=e.fare_amount)||void 0===s?void 0:s.toFixed(2)]})]}),e.driver&&"completed"===e.status&&(0,a.jsxs)("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-yellow-50",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),(0,a.jsx)("span",{className:"text-[15px] font-medium text-gray-900",children:e.driver_rating||"Not rated"})]})]})]},e.id)})})})]})}var k=t(7158),Z=t(5883),F=t(7579);function S(){let{profile:e,signOut:s}=(0,l.a)();return(0,a.jsx)("div",{className:"min-h-screen bg-[#F2F2F7] pb-20",children:(0,a.jsxs)("div",{className:"container mx-auto p-4 max-w-6xl space-y-4",children:[(0,a.jsxs)("div",{className:"ios-list rounded-xl overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-white px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center flex-shrink-0 overflow-hidden",children:(null==e?void 0:e.avatar_url)?(0,a.jsx)("img",{src:e.avatar_url,alt:e.full_name,className:"w-full h-full object-cover"}):(0,a.jsx)(g.Z,{className:"w-8 h-8 text-gray-500"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:(null==e?void 0:e.full_name)||"User"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-0.5",children:[(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 fill-yellow-500 text-yellow-500"}),(null==e?void 0:e.rating)?e.rating.toFixed(1):"0.0"]}),(0,a.jsx)("span",{className:"text-gray-300",children:"•"}),(0,a.jsxs)("span",{className:"flex items-center gap-1 text-sm text-gray-600",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4"}),(null==e?void 0:e.total_rides)||0," rides"]})]})]}),(0,a.jsx)(k.Z,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),(0,a.jsx)("div",{className:"ios-separator mx-4"}),(0,a.jsxs)("button",{onClick:s,className:"ios-list-item w-full flex items-center justify-between text-left",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full bg-red-100 flex items-center justify-center",children:(0,a.jsx)(Z.Z,{className:"w-4 h-4 text-red-600"})}),(0,a.jsx)("span",{className:"text-[17px] text-red-600 font-normal",children:"Sign Out"})]}),(0,a.jsx)(k.Z,{className:"w-5 h-5 text-gray-400"})]})]}),(0,a.jsxs)(F.mQ,{defaultValue:"book",className:"space-y-4",children:[(0,a.jsx)("div",{className:"ios-segment",children:(0,a.jsxs)(F.dr,{className:"w-full grid grid-cols-3 bg-transparent p-0 h-auto",children:[(0,a.jsx)(F.SP,{value:"book",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Book Ride"}),(0,a.jsx)(F.SP,{value:"active",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"Active"}),(0,a.jsx)(F.SP,{value:"history",className:"ios-segment-item data-[state=active]:ios-segment-item-active text-[15px]",children:"History"})]})}),(0,a.jsx)(F.nU,{value:"book",className:"mt-4 space-y-4",children:(0,a.jsx)(j,{})}),(0,a.jsx)(F.nU,{value:"active",className:"mt-4",children:(0,a.jsx)(y,{})}),(0,a.jsx)(F.nU,{value:"history",className:"mt-4",children:(0,a.jsx)(_,{})})]})]})})}}}]);